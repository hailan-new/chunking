#!/usr/bin/env python3
"""
è°ƒè¯•æ ‡é¢˜æ£€æµ‹é€»è¾‘
"""

import os
import sys
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from contract_splitter.docx_splitter import DocxSplitter


def debug_heading_detection():
    """è°ƒè¯•æ ‡é¢˜æ£€æµ‹é€»è¾‘"""
    print("ğŸ” è°ƒè¯•æ ‡é¢˜æ£€æµ‹é€»è¾‘")
    print("=" * 80)
    
    # åˆ›å»ºDocxSplitter
    splitter = DocxSplitter(max_tokens=2000, overlap=200)
    
    # æµ‹è¯•ä¸€äº›ç¤ºä¾‹æ–‡æœ¬
    test_texts = [
        "ä¸€ã€é¡¹ç›®åç§°ï¼š é¦–åˆ›è¯åˆ¸æ–°å¢ä»£é”€æœºæ„ - å¹¿å·å†œå•†è¡Œ",  # 26å­—ç¬¦
        "ï¼ˆä¸€ï¼‰å…¬å¸æ²»ç†ç»“æ„å®Œå–„ï¼Œå†…éƒ¨æ§åˆ¶æœ‰æ•ˆ",  # çŸ­æ–‡æœ¬
        "ï¼ˆäºŒï¼‰æ»¡è¶³ç›‘ç®¡è¦æ±‚ï¼Œæœªè§ç›‘ç®¡éƒ¨é—¨ï¼ˆè¯ç›‘ä¼šã€å›½å®¶é‡‘èç›‘ç£ç®¡ç†æ€»å±€ï¼‰é’ˆå¯¹è¯¥æœºæ„åŸºé‡‘é”€å”®ä¸šåŠ¡çš„åœä¸šæ•´æ”¹å¤„ç½šï¼Œç¡®ä¿è¯¥ä¸šåŠ¡åœ¨ç›‘ç®¡å…è®¸èŒƒå›´å†…æ­£å¸¸å±•ä¸š",  # é•¿æ–‡æœ¬
        "ï¼ˆä¸‰ï¼‰ç»„ç»‡æ¶æ„å®Œæ•´ï¼Œè®¾æœ‰ä¸“é—¨çš„äº§å“é”€å”®ä¸šåŠ¡å›¢é˜Ÿå’Œåˆ†ç®¡é”€å”®ä¸šåŠ¡çš„é«˜ç®¡ï¼Œé”€å”®ä¸šåŠ¡å›¢é˜Ÿçš„è®¾ç½®èƒ½ä¿è¯ä¸šåŠ¡è¿è¥çš„å®Œæ•´ä¸ç‹¬ç«‹ï¼Œé”€å”®ä¸šåŠ¡å›¢é˜Ÿæœ‰æ»¡è¶³è¥ä¸šéœ€è¦çš„å›ºå®šåœºæ‰€å’Œå®‰å…¨é˜²èŒƒæªæ–½",  # å¾ˆé•¿æ–‡æœ¬
        "äº”ã€é£é™©ç®¡ç†æªæ–½",  # çŸ­æ ‡é¢˜
        "ï¼ˆä¸€ï¼‰æ“ä½œé£é™© : æ ‡å‡†æµç¨‹æ‰‹å†ŒåŒ–è¿è¥çš„æ“ä½œé£é™©ç®¡ç†ä½“ç³»\nèµ„äº§ç®¡ç†æ˜¯ä¸€ä¸ªé•¿é“¾æ¡çš„ä¸šåŠ¡ï¼Œæ¶‰åŠåˆ°ä¼—å¤šç¯èŠ‚..."  # é•¿å†…å®¹
    ]
    
    print("ğŸ”§ æµ‹è¯•_detect_heading_level_simpleæ–¹æ³•:")
    for i, text in enumerate(test_texts):
        print(f"\næµ‹è¯•æ–‡æœ¬ {i+1}:")
        print(f"  é•¿åº¦: {len(text)} å­—ç¬¦")
        print(f"  å‰50å­—ç¬¦: {text[:50]}...")
        
        result = splitter._detect_heading_level_simple(text)
        print(f"  ç»“æœ: is_heading={result['is_heading']}, level={result['level']}")
        
        # æ£€æŸ¥æ˜¯å¦ä»¥æ ‡é¢˜æ ‡è®°å¼€å¤´
        starts_with_marker = False
        if text.startswith(('ä¸€ã€', 'äºŒã€', 'ä¸‰ã€', 'å››ã€', 'äº”ã€', 'å…­ã€', 'ä¸ƒã€', 'å…«ã€', 'ä¹ã€', 'åã€')):
            starts_with_marker = True
            print(f"  âœ… ä»¥ä¸€çº§æ ‡è®°å¼€å¤´")
        elif text.startswith(('ï¼ˆä¸€ï¼‰', 'ï¼ˆäºŒï¼‰', 'ï¼ˆä¸‰ï¼‰', 'ï¼ˆå››ï¼‰', 'ï¼ˆäº”ï¼‰', 'ï¼ˆå…­ï¼‰', 'ï¼ˆä¸ƒï¼‰', 'ï¼ˆå…«ï¼‰', 'ï¼ˆä¹ï¼‰', 'ï¼ˆåï¼‰')):
            starts_with_marker = True
            print(f"  âœ… ä»¥äºŒçº§æ ‡è®°å¼€å¤´")
        else:
            print(f"  âŒ ä¸ä»¥æ ‡é¢˜æ ‡è®°å¼€å¤´")
        
        # åˆ†æä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªç»“æœ
        if len(text) > 50 and result['is_heading']:
            print(f"  âš ï¸  è­¦å‘Š: æ–‡æœ¬è¶…è¿‡50å­—ç¬¦ä½†ä»è¢«æ ‡è®°ä¸ºæ ‡é¢˜!")
        elif len(text) <= 50 and starts_with_marker and not result['is_heading']:
            print(f"  âš ï¸  è­¦å‘Š: çŸ­æ–‡æœ¬æœ‰æ ‡é¢˜æ ‡è®°ä½†æœªè¢«æ ‡è®°ä¸ºæ ‡é¢˜!")


def main():
    """ä¸»å‡½æ•°"""
    print("ğŸš€ æ ‡é¢˜æ£€æµ‹è°ƒè¯•")
    print("=" * 80)
    
    debug_heading_detection()
    
    print("\n" + "=" * 80)
    print("ğŸ¯ è°ƒè¯•å®Œæˆ")


if __name__ == "__main__":
    main()
